
{% extends 'base.html' %}
{% load staticfiles %} 

{% load blog_tags %}
{% load socialaccount %}


{% block SimeditorCss %}
<link rel="stylesheet" type="text/css" href="{% static 'blog/simeditor2.3.16/styles/simditor.css' %}" />
{% endblock SimeditorCss %}

{% block main %}

<div class="jumbotron">
        <h1>{{ post.title }}</h1>
        <p>{{ post.body }}</p>
        <p><a class="btn btn-primary btn-sm" href="#" role="button">{{ post.created_time }}</a></p>
        <p><a class="btn btn-primary btn-sm" href="#" role="button">{{ post.author }}</a></p>
        <p><a class="btn btn-primary btn-sm" href="#" role="button">{{ post.category.name }}</a></p>
</div>


<form class="form-horizontal" action="{% url 'comments:post_comments' post.pk %}" method="post" role="form">
<table>

            {% csrf_token %}
            {% if user.is_authenticated %}
            <div class="form-group">
                 <label for="editor" class="col-sm-2 control-label">内容:</label>
                <div class="col-sm-10">
                    <textarea class="form-control" name="content" id="editor" placeholder="提出你的疑问？" autofocus></textarea>
                    <input type="hidden" name="parent" value="" />
                    <input type="hidden" name="user" value="2" />
                    <input type="hidden" name="post" value="{{ post.pk }}" />
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                     <input type="submit" name="submit" class="btn btn-default" value="发表"/>
                     
                </div>
            </div>
            {% else %}
            <div class="flex-center top-gap login-panel p-7">
                <div>
                  <div class="text-muted text-center login-header"><span>登录后回复</span></div>
                  <div id="app-login" class="flex-center text-center social-icons mt-3">
                                      <span class="weibo mr-3">
                                          <a href="{% provider_login_url 'weibo' %}">
                                              <i class="fa fa-weibo" aria-hidden="true"></i>
                                          </a>
                                      </span>
                    <span class="github">
                                          <a href="{% provider_login_url 'github' %}">
                                              <i class="fa fa-github" aria-hidden="true"></i>
                                          </a>
                                      </span>
                  </div>
                </div>
              </div>
            {% endif %}

</table>
</form>


<ul class="media-list">
        {% recursetree comments_list %}
        <li class="media">
            <a class="media-left" href="#" id="c{{ node.pk }}">
                {% if node.user.social_avatar  %}
                <img width="30px" height="30px" alt="{{ node.user.username }}" src="{{ node.user.social_avatar  }}">
                {% else %}
                <img class="media-object" src="{% static 'blog/images/author.svg' %}" alt="{{ node.user.username }}">
                {% endif %}
            </a>
            <div class="media-body">
                <h4 class="media-heading">
                        {{node.user}}
                </h4>
                <p>
                    {{node.content|safe}}
                </p>
                <p>
                    {{node.created_time|timesince}} 之前.<a href="{% url 'comments:reply' node.pk %}">回复</a>
                </p>             
                {% if not node.is_leaf_node %}
                <!-- 嵌套的媒体对象 -->
                <ul class="media-list">
                    
                    {{ children }}
                    
                </ul>
                {% endif %}
            </div>
        </li>
        {% endrecursetree %}
 </ul>

{% endblock main%}



{% block aside %}
<div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">
                Panel title
            </h3>
        </div>
        <div class="panel-body">
            Panel content
        </div>
        <div class="panel-footer">
            Panel footer
        </div>
    </div>

{% endblock aside %}

{% block SimeditorJs %}
<script type="text/javascript" src="{% static 'blog/simeditor2.3.16/scripts/jquery.min.js' %}"></script>
<script type="text/javascript" src="{% static 'blog/simeditor2.3.16/scripts/module.js' %}"></script>
<script type="text/javascript" src="{% static 'blog/simeditor2.3.16/scripts/hotkeys.js' %} "></script>
<script type="text/javascript" src="{% static 'blog/simeditor2.3.16/scripts/uploader.js' %}"></script>
<script type="text/javascript" src="{% static 'blog/simeditor2.3.16/scripts/simditor.js' %}"></script>
<script type="text/javascript">
    var editor = new Simditor({
    textarea: $('#editor')

  });
</script>
{% endblock SimeditorJs %}

